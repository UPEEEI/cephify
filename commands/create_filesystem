#/bin/bash
echo "create_filesystem"
echo "Do you want to create a Ceph client on $1? Make sure a cluster and pool already exist"
select yn in "Yes" "No"; do
    case $yn in
        Yes ) break;;
        No ) exit;;
    esac
done

conf_loc=$(find /etc/ceph/ -type f -name "*conf")
cluster_name=$(basename -a -s ".conf" $conf_loc)

echo "Installing Ceph-fuse on $1..."
sleep 1
ssh $1 "apt update; apt -y install ceph-fuse"

echo "Transferring required files..."
sleep 1

scp /etc/ceph/$cluster_name.conf $1:/etc/ceph/$cluster_name.conf
scp /etc/ceph/$cluster_name.client.admin.keyring $1:/etc/ceph
ssh $1 "chown ceph. /etc/ceph/ceph.*"
